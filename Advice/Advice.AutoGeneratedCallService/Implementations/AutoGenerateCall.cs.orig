using System;
using System.Reflection;
using System.Threading.Tasks;
using Advice.AutoGeneratedCallService.Contracts;
using Advice.Logging;
using Advice.Logging.Contracts;
using Advice.Logging.Models;

namespace Advice.AutoGeneratedCallService.Implementations
{
    public class AutoGenerateCall : IAutoGenerateCall
    {
        private readonly INoaAutoGenerateCallService _noaAutoGenerateCallService;
        private readonly INonNoaAutoGenerateCallService _nonNoaAutoGenerateCallService;
        public static readonly IElkLog Log = ElkLogManager.GetLogger(MethodBase.GetCurrentMethod().DeclaringType);
        public AutoGenerateCall(INoaAutoGenerateCallService noaAutoGenerateCallService, INonNoaAutoGenerateCallService nonNoaAutoGenerateCallService)
        {
            _noaAutoGenerateCallService = noaAutoGenerateCallService;
            _nonNoaAutoGenerateCallService = nonNoaAutoGenerateCallService;
        }
        public void Run()
        {
            Task.Factory.StartNew(() =>
            {
                Log.Info(new InfoLogRequest()
                {
                    IndexType = ElkIndexTypeProvider.NoaGeneratedCalls,
                    Message = "NOA Auto generated call service started"
                });

                _noaAutoGenerateCallService.GenerateTasks();

                Log.Info(new InfoLogRequest()
                {
                    IndexType = ElkIndexTypeProvider.NoaGeneratedCalls,
                    Message = "NOA Auto generated call service ended"
                });
            });

            Task.Factory.StartNew(() =>
            {
                Log.Info(new InfoLogRequest()
                {
                    IndexType = ElkIndexTypeProvider.NonNoaGeneratedCalls,
                    Message = "Non NOA Auto generated call service started"
                });

                _nonNoaAutoGenerateCallService.GenerateTasks();

                Log.Info(new InfoLogRequest()
                {
                    IndexType = ElkIndexTypeProvider.NonNoaGeneratedCalls,
                    Message = "Non NOA Auto generated call service ended"
                });
            });
            
        }
    }
}
